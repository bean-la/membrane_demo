version: '3'

services:
  hls_proxy_api:
    build:
      context: ./hls_proxy_api
    environment:
      - UDP_PORT=20000
      - PLAYER_BASE_URL=http://${PUBLIC_IP}:8000
      - SERVER_BASE_URL=http://${PUBLIC_IP}:8080
      - OUTPUT_PATH=/app/output
      - HLS_PATH=stream
    ports:
      - "20000-20004:20000-20004/udp"
    depends_on:
      - hls_proxy_server
    volumes:
      - output:/app/output
  hls_proxy_server:
    build:
      context: ./hls_proxy_server
    environment:
      - PLAYER_BASE_URL=http://${PUBLIC_IP}:8000
    ports:
      - 8080:80
    volumes:
      - output:/hls_output
  hls_proxy_player:
    build:
      context: ./hls_proxy_player
    environment:
      - SERVER_BASE_URL=http://${PUBLIC_IP}:8080
      - HLS_PATH=stream
    ports:
      - 8000:80
volumes:
  output:
